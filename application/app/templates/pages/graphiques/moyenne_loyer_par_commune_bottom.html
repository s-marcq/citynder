{% extends "partials/conteneur.html" %}

{% block body %}
<div class="container">
    <div class="row justify-content-center">
        <h1 class="text-center">Les 30 communes les moins chères de France (autour de 5 €/m²)</h1>
    </div>
    <div class="row justify-content-center">
        <div>
            <canvas id="graphique_bottom_30" style="width: 1000px;"></canvas>
        </div>
    </div>      
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-deferred@1.0.2/dist/chartjs-plugin-deferred.min.js"></script>
    <script type="text/javascript" src="https://github.com/nagix/chartjs-plugin-colorschemes/releases/download/v0.4.0/chartjs-plugin-colorschemes.js"></script>
    <script>
        const ctx_bottom_30 = document.getElementById('graphique_bottom_30');
        var graphe_bottom_30 = new Chart(ctx_bottom_30, {
            type: 'polarArea',
            data: {
                labels: [],
                datasets: [{
                    data: []
                }]
            },
            options: {}
        });

        fetch('{{ url_for("moyenne_loyer_par_commune_data_bottom_30") }}')
            .then(response => response.json())
            .then(data => {
                // Calcul des labels et des nombres
                const labels_bottom_30 = data.map(commune => commune.label);
                const nombres_bottom_30 = data.map(commune => commune.nombre);

                // Ajout des données dans le graphique
                graphe_bottom_30.data.labels = labels_bottom_30;
                graphe_bottom_30.data.datasets.forEach(dataset => {
                    dataset.data = nombres_bottom_30;
                });

                // Réglage du schéma de couleurs
                graphe_bottom_30.options.plugins.colorschemes.scheme = 'tableau.HueCircle19';
                graphe_bottom_30.update();
            });
        </script>
    </div>
</div>

{% endblock %}
